# Google テスト xTS アップロード事前チェックツール
### Claude Code 実装用・確定仕様書

> 以下は Claude Code に実装させるための仕様書です。
> 本仕様書に記載されている内容のみを実装対象とし、
> 推測や仕様追加は行わず、そのまま実装してください。

---

## 1. 目的（Why）

Google のテスト xTS アップロード時にリジェクトされる原因となる  
**典型的で致命的な不備を、アップロード前に確実に検出する**ための  
ローカル社内チェックツールを作成する。

特に、**一度でもリジェクトされた実績のある項目を100% NG として検出**することを最優先とする。

---

## 2. 対象範囲（Scope）

### 含むもの
- Google テスト xTS の **結果HTMLファイル**を入力とする
- 以下の不備を **すべて NG として検出**する：
  1. 必要項目（必須テスト）の未実施
  2. FAIL して PASS していないテストの存在
  3. テスト実施端末の fingerprint 不一致
- 検出結果を **CSV形式で一覧出力**する
- 単一ユーザー（アップロード担当者本人）向けローカルツール

### 含まないもの（Non-scope）
- Google への実際のアップロード処理
- テスト xTS の実行・生成
- マルチユーザー対応
- 権限管理・ログイン機能
- クラウド・Webサービス化

---

## 3. 前提条件・制約

- 実行環境：Windows 11
- 利用形態：ローカル実行
- ネットワーク接続は必須としない
- Google 側の内部仕様の完全再現は行わない  
  （**過去にリジェクトされた具体的なパターンのみを確実に検出する**）

---

## 4. 入力（Input）

### 入力形式
- ファイル形式：HTML
- 内容：Google テスト xTS の結果レポート

### 入力方法
- ローカルファイルパスの指定
- ファイルが読み取れない場合は即時エラーとして処理終了

### 想定入力例

```
C:/xts_results/result_20240130.html
```

---

## 5. 出力（Output）

### 出力形式
- CSV
- 1行＝1チェック項目

### CSV列定義

- `check_item` : チェック項目名
- `result` : 常に `NG` または `OK`
- `description` : 問題内容の説明
- `location` : 該当箇所（可能な範囲でHTML内の情報）

### 出力例

```csv
check_item,result,description,location
必須テスト未実施,NG,必須とされる〇〇テストが見つかりません,summary
テストFAIL残存,NG,FAILしているテストがPASSになっていません,test_id=1234
fingerprint不一致,NG,実行端末のfingerprintが一致していません,device_section
```

※ WARN 概念は存在しない  
→ **問題が1つでもあればすべて NG として出力する**

---

## 6. チェック内容・判定ルール（確定）

以下はすべて **NG 判定**とする。

### 6.1 必要項目（必須テスト）の未実施
- HTML 内に存在すべき必須テストが存在しない場合
- 「未実施」「Not Run」等の状態も NG 扱い

### 6.2 FAIL して PASS していないテストの存在
- 1件でも FAIL 判定が残っている場合は NG
- 再実行で PASS になっていない FAIL はすべて対象

### 6.3 テスト実施端末 fingerprint の不一致
- テスト結果内に記載されている fingerprint が
  - 期待される fingerprint と一致しない
  - 複数存在し整合性が取れない
- 上記いずれも NG

---

## 7. 処理フロー

1. HTMLファイルを読み込む
2. HTMLを解析（DOM構造として処理）
3. 以下を順にチェック：
   - 必須テストの存在確認
   - FAIL状態テストの抽出
   - fingerprint 情報の整合性確認
4. 各チェック結果を内部データとして保持
5. CSV形式で出力
6. エラー発生時も可能な範囲で処理を継続する

---

## 8. エラー処理方針

- HTMLが読み取れない場合：即時エラー
- HTML構造が想定外の場合：
  - 処理不能部分は NG として出力
  - 例外で全体を停止しない

---

## 9. 完了条件（Definition of Done）

- 代表的な xTS 結果HTMLで正常に動作する
- 過去に Google にリジェクトされた要因をすべて NG として検出できる
- CSV を見れば「アップロードして良いか否か」が即座に判断できる
- 本仕様書以外の機能は実装されていない

---

## 10. 将来拡張（今回の実装対象外）

- 視覚的なHTMLレポート出力
- GUI表示
- チェック項目の設定ファイル化
- 複数ファイル同時チェック
